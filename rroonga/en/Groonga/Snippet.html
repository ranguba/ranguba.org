<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../ranguba.css" type="text/css" />
    <link rel="shortcut icon" href="../../../favicon.ico" />
    <link rel="icon" href="../../../favicon.png" />
    <title>
  Class: Groonga::Snippet
  
    &mdash; rroonga
  
 - Ranguba</title>


  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
<div class="header">
  <div class="title">
    <a href="../../../">
      <span class="title">
  Class: Groonga::Snippet
  
    &mdash; rroonga
  
</span>
      <span class="title-separator">-</span>
      <span class="title-project">Ranguba</span>
    </a>
  </div>
  <ul class="other-languages">
    <li id="other-language-japanese" lang="ja" xml:lang="ja"><a href="../../../rroonga/ja/Groonga/Snippet.html">日本語</a></li>
  </ul>
  <ul class="menu">
    <li id="menu-reference"><a href="../../../rroonga/en/">Reference Manual</a></li>
    <li id="menu-tutorial"><a href="../../../rroonga/en/file.tutorial.html">Tutorial</a></li>
    <li id="menu-install"><a href="../../../#install-rroonga">Install</a></li>
    <li id="menu-developer"><a href="../../../developer.html">Developer</a></li>
  </ul>
</div>

<div class="content">


    <div id="header">
      <div id="menu">
  
    <a href="../alphabetical_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Groonga.html" title="Groonga (module)">Groonga</a></span></span>
     &raquo; 
    <span class="title">Snippet</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Groonga::Snippet
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></li>
          
            <li class="next">Groonga::Snippet</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/groonga/rb-grn-snippet.c<span class="defines">,<br />
  ext/groonga/rb-grn-snippet.c</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>スニペット（検索語周辺のテキスト）を生成するためのオブジェクト。</p>

  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_keyword-instance_method" title="#add_keyword (instance method)">- (Object) <strong>add_keyword</strong>(keyword, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p><em>keyword</em> を追加する。.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">- (::Array) <strong>execute</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p><em>string</em> を走査し、スニペットを作成する。.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#new (instance method)">- (Object) <strong>new</strong>(options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>スニペットを作成する。.</p></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Object.html#%3D%3D-instance_method" title="Groonga::Object#== (method)">#==</a></span>, <span class='object_link'><a href="Object.html#%5B%5D-instance_method" title="Groonga::Object#[] (method)">#[]</a></span>, <span class='object_link'><a href="Object.html#%5B%5D%3D-instance_method" title="Groonga::Object#[]= (method)">#[]=</a></span>, <span class='object_link'><a href="Object.html#append-instance_method" title="Groonga::Object#append (method)">#append</a></span>, <span class='object_link'><a href="Object.html#builtin%3F-instance_method" title="Groonga::Object#builtin? (method)">#builtin?</a></span>, <span class='object_link'><a href="Object.html#close-instance_method" title="Groonga::Object#close (method)">#close</a></span>, <span class='object_link'><a href="Object.html#closed%3F-instance_method" title="Groonga::Object#closed? (method)">#closed?</a></span>, <span class='object_link'><a href="Object.html#domain-instance_method" title="Groonga::Object#domain (method)">#domain</a></span>, <span class='object_link'><a href="Object.html#id-instance_method" title="Groonga::Object#id (method)">#id</a></span>, <span class='object_link'><a href="Object.html#inspect-instance_method" title="Groonga::Object#inspect (method)">#inspect</a></span>, <span class='object_link'><a href="Object.html#name-instance_method" title="Groonga::Object#name (method)">#name</a></span>, <span class='object_link'><a href="Object.html#path-instance_method" title="Groonga::Object#path (method)">#path</a></span>, <span class='object_link'><a href="Object.html#persistent%3F-instance_method" title="Groonga::Object#persistent? (method)">#persistent?</a></span>, <span class='object_link'><a href="Object.html#prepend-instance_method" title="Groonga::Object#prepend (method)">#prepend</a></span>, <span class='object_link'><a href="Object.html#range-instance_method" title="Groonga::Object#range (method)">#range</a></span>, <span class='object_link'><a href="Object.html#remove-instance_method" title="Groonga::Object#remove (method)">#remove</a></span>, <span class='object_link'><a href="Object.html#temporary%3F-instance_method" title="Groonga::Object#temporary? (method)">#temporary?</a></span>, <span class='object_link'><a href="Object.html#unlink-instance_method" title="Groonga::Object#unlink (method)">#unlink</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>new</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>スニペットを作成する。</p>

  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>::Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The name and value
pairs. Omitted names are initialized as the default value.</p></div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:context</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>Groonga::Context.default</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>スキーマ作成時に使用するGroonga::Contextを指定する。</p></div>
          
        </li>
      
        <li>
          <span class="name">:normalize</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>キーワード文字列・スニペット元の文字列を正規化するかどうか。
省略した場合は <ins>false</ins> で正規化しない。</p></div>
          
        </li>
      
        <li>
          <span class="name">:skip_leading_spaces</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>先頭の空白を無視するかどうか。省略した場合は <ins>false</ins> で無視しない。</p></div>
          
        </li>
      
        <li>
          <span class="name">:width</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>100</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>スニペット文字列の長さ。省略した場合は100文字。</p></div>
          
        </li>
      
        <li>
          <span class="name">:max_results</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>3</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>生成するスニペットの最大数。省略した場合は3。</p></div>
          
        </li>
      
        <li>
          <span class="name">:html_escape</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>スニペット内の <ins>&lt;</ins> , <ins>&gt;</ins> , <ins>&amp;</ins> , <ins>&quot;</ins> をHTMLエスケープするかどうか。
省略した場合は <ins>false</ins> で、HTMLエスケープしない。</p></div>
          
        </li>
      
        <li>
          <span class="name">:default_open_tag</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>デフォルトの開始タグ。省略した場合は&quot;&quot;(空文字列)</p></div>
          
        </li>
      
        <li>
          <span class="name">:default_close_tag</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>デフォルトの終了タグ。省略した場合は&quot;&quot;(空文字列)</p></div>
          
        </li>
      
    </ul>
  


</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-snippet.c', line 82</span>

static VALUE
rb_grn_snippet_initialize (int argc, VALUE *argv, VALUE self)
{
    grn_ctx *context = NULL;
    grn_obj *snippet = NULL;
    VALUE options;
    VALUE rb_context, rb_normalize, rb_skip_leading_spaces;
    VALUE rb_width, rb_max_results, rb_default_open_tag, rb_default_close_tag;
    VALUE rb_html_escape;
    int flags = GRN_SNIP_COPY_TAG;
    unsigned int width = 100;
    unsigned int max_results = 3;
    char *default_open_tag = NULL;
    unsigned int default_open_tag_length = 0;
    char *default_close_tag = NULL;
    unsigned int default_close_tag_length = 0;
    grn_snip_mapping *mapping = NULL;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;options);

    rb_grn_scan_options(options,
                        &quot;context&quot;, &amp;rb_context,
                        &quot;normalize&quot;, &amp;rb_normalize,
                        &quot;skip_leading_spaces&quot;, &amp;rb_skip_leading_spaces,
                        &quot;width&quot;, &amp;rb_width,
                        &quot;max_results&quot;, &amp;rb_max_results,
                        &quot;default_open_tag&quot;, &amp;rb_default_open_tag,
                        &quot;default_close_tag&quot;, &amp;rb_default_close_tag,
                        &quot;html_escape&quot;, &amp;rb_html_escape,
                        NULL);

    context = rb_grn_context_ensure(&amp;rb_context);
    if (!grn_ctx_db(context)) {
        rb_raise(rb_eArgError,
                 &quot;Groonga::Context should be associated with a database by &quot;
                 &quot;Groonga::Database#open or #create: %s&quot;,
                 rb_grn_inspect(rb_context));
    }

    if (RVAL2CBOOL(rb_normalize))
        flags |= GRN_SNIP_NORMALIZE;
    if (RVAL2CBOOL(rb_skip_leading_spaces))
        flags |= GRN_SNIP_SKIP_LEADING_SPACES;

    if (!NIL_P(rb_width))
        width = NUM2UINT(rb_width);

    if (!NIL_P(rb_max_results))
        max_results = NUM2UINT(rb_max_results);

    if (!NIL_P(rb_default_open_tag)) {
        default_open_tag = StringValuePtr(rb_default_open_tag);
        default_open_tag_length = RSTRING_LEN(rb_default_open_tag);
    }

    if (!NIL_P(rb_default_close_tag)) {
        default_close_tag = StringValuePtr(rb_default_close_tag);
        default_close_tag_length = RSTRING_LEN(rb_default_close_tag);
    }

    if (RVAL2CBOOL(rb_html_escape))
        mapping = (grn_snip_mapping *)-1;

    snippet = grn_snip_open(context, flags, width, max_results,
                            default_open_tag, default_open_tag_length,
                            default_close_tag, default_close_tag_length,
                            mapping);
    rb_grn_context_check(context, rb_ary_new4(argc, argv));

    rb_grn_object_assign(Qnil, self, rb_context, context, snippet);
    rb_grn_context_register_floating_object(DATA_PTR(self));

    rb_iv_set(self, &quot;@context&quot;, rb_context);

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_keyword-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>add_keyword</strong>(keyword, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p><em>keyword</em> を追加する。</p>

  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keyword</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>追加するキーワード</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>::Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The name and value
pairs. Omitted names are initialized as the default value.</p></div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:open_tag</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>default_open_tag</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>開始タグ。省略した場合はGroonga::Snippet.newで指定した
<ins>:default_open_tag</ins> 。</p></div>
          
        </li>
      
        <li>
          <span class="name">:close_tag</span>
          <span class="type">(<tt><span class='object_link'><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:default_close_tag</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>終了タグ。省略した場合はGroonga::Snippet.newで指定した
<ins>:default_close_tag</ins> 。</p></div>
          
        </li>
      
    </ul>
  


</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-snippet.c', line 173</span>

static VALUE
rb_grn_snippet_add_keyword (int argc, VALUE *argv, VALUE self)
{
    grn_ctx *context;
    grn_obj *snippet;
    grn_rc rc;
    VALUE rb_keyword, options;
    VALUE rb_open_tag, rb_close_tag;
    char *keyword, *open_tag = NULL, *close_tag = NULL;
    unsigned int keyword_length, open_tag_length = 0, close_tag_length = 0;

    rb_grn_snippet_deconstruct(SELF(self), &amp;snippet, &amp;context);

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;rb_keyword, &amp;options);

    keyword = StringValuePtr(rb_keyword);
    keyword_length = RSTRING_LEN(rb_keyword);

    rb_grn_scan_options(options,
                        &quot;open_tag&quot;, &amp;rb_open_tag,
                        &quot;close_tag&quot;, &amp;rb_close_tag,
                        NULL);

    if (!NIL_P(rb_open_tag)) {
        open_tag = StringValuePtr(rb_open_tag);
        open_tag_length = RSTRING_LEN(rb_open_tag);
    }

    if (!NIL_P(rb_close_tag)) {
        close_tag = StringValuePtr(rb_close_tag);
        close_tag_length = RSTRING_LEN(rb_close_tag);
    }

    rc = grn_snip_add_cond(context, snippet,
                           keyword, keyword_length,
                           open_tag, open_tag_length,
                           close_tag, close_tag_length);
    rb_grn_rc_check(rc, self);

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute-instance_method">
  
    - (<tt>::Array</tt>) <strong>execute</strong>(string) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p><em>string</em> を走査し、スニペットを作成する。</p>

  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>string</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>走査する文字列</p></div>
      
    </li>
  
</ul>


</div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>::Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>作成されたスニペットの配列</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-snippet.c', line 222</span>

static VALUE
rb_grn_snippet_execute (VALUE self, VALUE rb_string)
{
    grn_rc rc;
    grn_ctx *context;
    grn_obj *snippet;
    char *string;
    unsigned int string_length;
    unsigned int i, n_results, max_tagged_length;
    VALUE rb_results;
    char *result;

    rb_grn_snippet_deconstruct(SELF(self), &amp;snippet, &amp;context);

    if (TYPE(rb_string) != T_STRING) {
        rb_raise(rb_eGrnInvalidArgument,
                 &quot;snippet text must be String: &lt;%s&gt;&quot;,
                 rb_grn_inspect(rb_string));
    }

#ifdef HAVE_RUBY_ENCODING_H
    rb_string = rb_grn_context_rb_string_encode(context, rb_string);
#endif
    string = StringValuePtr(rb_string);
    string_length = RSTRING_LEN(rb_string);

    rc = grn_snip_exec(context, snippet, string, string_length,
                       &amp;n_results, &amp;max_tagged_length);
    rb_grn_context_check(context, self);
    rb_grn_rc_check(rc, self);

    rb_results = rb_ary_new2(n_results);
    result = ALLOCA_N(char, max_tagged_length);
    for (i = 0; i &lt; n_results; i++) {
        VALUE rb_result;
        unsigned result_length;

        rc = grn_snip_get_result(context, snippet,
                                 i, result, &amp;result_length);
        rb_grn_rc_check(rc, self);
        rb_result = rb_grn_context_rb_string_new(context, result, result_length);
        rb_ary_push(rb_results, rb_result);
    }

    return rb_results;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer"></div>

  
    </div>

    <div class="sponsors">
      <p id="sponsor-github">
        <a href="https://github.com/ranguba/">
          <img src="../../../github-logo.png" width="100" height="45" border="0" alt="The Ranguba project uses GitHub's git repositories." />
        </a>
      </p>
      <p id="sponsor-tango">
	<a href="http://tango.freedesktop.org/">
          <img width="120" height="53" border="0" alt="Tango Desktop Project's icons are used." src="../../../tango-logo.png" />
        </a>
      </p>
      <p id="sponsor-famfamfam">
	<a href="http://www.famfamfam.com/">
          <img width="120" height="18" border="0" alt="famfamfam.com's flags are used." src="../../../famfamfam-logo.png" />
        </a>
      </p>
    </div>

</body>
</html>