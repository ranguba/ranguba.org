<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../ranguba.css" type="text/css" />
    <link rel="shortcut icon" href="../../../favicon.ico" />
    <link rel="icon" href="../../../favicon.png" />
    <title>
  Class: Groonga::Database
  
    &mdash; rroonga
  
 - ラングバ</title>


  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
<div class="header">
  <div class="title">
    <a href="../../../index.html.ja">
      <span class="title">
  Class: Groonga::Database
  
    &mdash; rroonga
  
</span>
      <span class="title-separator">-</span>
      <span class="title-project">ラングバ</span>
    </a>
  </div>
  <ul class="other-languages">
    <li id="other-language-english" lang="en" xml:lang="en"><a href="../../../rroonga/en/Groonga/Database.html">English</a></li>
  </ul>
  <ul class="menu">
    <li id="menu-reference"><a href="../../../rroonga/ja/">リファレンスマニュアル</a></li>
    <li id="menu-tutorial"><a href="../../../rroonga/ja/file.tutorial.html">チュートリアル</a></li>
    <li id="menu-install"><a href="../../../index.html.ja#install-rroonga">インストール</a></li>
    <li id="menu-developer"><a href="../../../developer.html.ja">開発者向け情報</a></li>
  </ul>
</div>

<div class="content">


    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (D)</a> &raquo;
    <span class="title"><span class="object_link"><a href="../Groonga.html" title="Groonga (module)">Groonga</a></span></span>
     &raquo; 
    <span class="title">Database</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">フレーム無し</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link" href="../class_list.html">クラスリスト</a>
  
    <a class="full_list_link" id="method_list_link" href="../method_list.html">メソッドリスト</a>
  
    <a class="full_list_link" id="file_list_link" href="../file_list.html">ファイルリスト</a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Groonga::Database
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></li>
          
            <li class="next">Groonga::Database</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Enumerable, <span class="object_link"><a href="EncodingSupport.html" title="Groonga::EncodingSupport (module)">EncodingSupport</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">ext/groonga/rb-grn-database.c<span class="defines">,<br />
  lib/groonga/database.rb,<br /> ext/groonga/rb-grn-database.c</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>テーブルの集合を管理するためのオブジェクト。</p>
<p>コンテキストに結びつけて使用する。通常、アプリケーション
毎に1つのコンテキストを利用するので、データベースも1つだ
け利用する。コンテキストと違い、データベースは暗黙のうち
に作成されないので明示的に作成する必要がある。</p>

  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-class_method" title="Groonga::Database.create (class method)">+ (Groonga::Database) <strong>Groonga::Database.create</strong>(options = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>新しくデータベースを作成する。.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-class_method" title="open (class method)">+ (Object) <strong>open</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>既存のデータベースを開く。ブロックを指定した場合はブロッ
クに開いたデータベースを渡し、ブロックを抜けるときに閉じ
る。.</p></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_lock-instance_method" title="#clear_lock (instance method)">- (Object) <strong>clear_lock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>call-seq:.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">- (Object) <strong>close</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>call-seq:.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#defrag-instance_method" title="#defrag (instance method)">- (Integer) <strong>defrag</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>call-seq:.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each-instance_method" title="#each (instance method)">- (Object) <strong>each</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>データベース内のオブジェクトを順番にブロックに渡す。.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Object) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>既存のデータベースを開く。ブロックを指定した場合はブロッ
クに開いたデータベースを渡し、ブロックを抜けるときに閉じ
る。.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lock-instance_method" title="#lock (instance method)">- (Object) <strong>lock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>call-seq:.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#locked%3F-instance_method" title="#locked? (instance method)">- (Boolean) <strong>locked?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>call-seq:.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tables-instance_method" title="#tables (instance method)">- (Array&lt;Groonga::Table] tables defined in the database) <strong>tables</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>Array&lt;Groonga::Table] tables defined in the database.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#touch-instance_method" title="#touch (instance method)">- (Object) <strong>touch</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>call-seq:.</p></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unlock-instance_method" title="#unlock (instance method)">- (Object) <strong>unlock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline"><p>call-seq:.</p></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class="object_link"><a href="EncodingSupport.html" title="Groonga::EncodingSupport (module)">EncodingSupport</a></span></h3>
  <p class="inherited"><span class="object_link"><a href="EncodingSupport.html#encoding-instance_method" title="Groonga::EncodingSupport#encoding (method)">#encoding</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></h3>
  <p class="inherited"><span class="object_link"><a href="Object.html#%3D%3D-instance_method" title="Groonga::Object#== (method)">#==</a></span>, <span class="object_link"><a href="Object.html#%5B%5D-instance_method" title="Groonga::Object#[] (method)">#[]</a></span>, <span class="object_link"><a href="Object.html#%5B%5D%3D-instance_method" title="Groonga::Object#[]= (method)">#[]=</a></span>, <span class="object_link"><a href="Object.html#append-instance_method" title="Groonga::Object#append (method)">#append</a></span>, <span class="object_link"><a href="Object.html#builtin%3F-instance_method" title="Groonga::Object#builtin? (method)">#builtin?</a></span>, <span class="object_link"><a href="Object.html#closed%3F-instance_method" title="Groonga::Object#closed? (method)">#closed?</a></span>, <span class="object_link"><a href="Object.html#domain-instance_method" title="Groonga::Object#domain (method)">#domain</a></span>, <span class="object_link"><a href="Object.html#id-instance_method" title="Groonga::Object#id (method)">#id</a></span>, <span class="object_link"><a href="Object.html#inspect-instance_method" title="Groonga::Object#inspect (method)">#inspect</a></span>, <span class="object_link"><a href="Object.html#name-instance_method" title="Groonga::Object#name (method)">#name</a></span>, <span class="object_link"><a href="Object.html#path-instance_method" title="Groonga::Object#path (method)">#path</a></span>, <span class="object_link"><a href="Object.html#persistent%3F-instance_method" title="Groonga::Object#persistent? (method)">#persistent?</a></span>, <span class="object_link"><a href="Object.html#prepend-instance_method" title="Groonga::Object#prepend (method)">#prepend</a></span>, <span class="object_link"><a href="Object.html#range-instance_method" title="Groonga::Object#range (method)">#range</a></span>, <span class="object_link"><a href="Object.html#remove-instance_method" title="Groonga::Object#remove (method)">#remove</a></span>, <span class="object_link"><a href="Object.html#temporary%3F-instance_method" title="Groonga::Object#temporary? (method)">#temporary?</a></span>, <span class="object_link"><a href="Object.html#unlink-instance_method" title="Groonga::Object#unlink (method)">#unlink</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    
      <span class="overload">- (<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>) <strong>Groonga::Database.new</strong>(path, options = nil) </span>
    
      <span class="overload">- (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>Groonga::Database.new</strong>(path, options = nil) {|database| ... }</span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>既存のデータベースを開く。ブロックを指定した場合はブロッ
クに開いたデータベースを渡し、ブロックを抜けるときに閉じ
る。</p>
<p><em>options</em> にはハッシュでオプションを指定する。指定できるオ
プションは以下の通り。</p>

  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>) <strong>Groonga::Database.new</strong>(path, options = nil) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class="type">(<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>Groonga::Database.new</strong>(path, options = nil) {|database| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class="type">(<tt>database</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class="name">options</span>
      
      
        <span class="type">(<tt>::Hash</tt>)</span>
      
      
      
        &mdash;
        <div class="inline"><p>The name and value
pairs. Omitted names are initialized as the default value.</p></div>
      
    </li>
  
</ul>

  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 256</span>

static VALUE
rb_grn_database_initialize (int argc, VALUE *argv, VALUE self)
{
    grn_ctx *context;
    grn_obj *old_database, *database;
    const char *path;
    VALUE rb_path, options, rb_context;

    rb_scan_args(argc, argv, "11", &amp;rb_path, &amp;options);

    path = StringValuePtr(rb_path);
    rb_grn_scan_options(options,
			"context", &amp;rb_context,
			NULL);

    context = rb_grn_context_ensure(&amp;rb_context);

    old_database = grn_ctx_db(context);
    if (old_database)
	grn_obj_unlink(context, old_database);
    reset_floating_objects(rb_context);
    database = grn_db_open(context, path);
    rb_grn_object_assign(Qnil, self, rb_context, context, database);
    rb_grn_context_check(context, self);

    rb_iv_set(self, "@context", rb_context);
    if (!NIL_P(rb_context))
	rb_iv_set(rb_context, "database", self);

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-class_method">
  
    + (<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>) <strong>Groonga::Database.create</strong>(options = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>新しくデータベースを作成する。</p>
<p><em>options</em> にはハッシュでオプションを指定する。指定できるオ
プションは以下の通り。</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code">一時データベースを作成:
Groonga::Database.create

永続データベースを作成:
Groonga::Database.create(:path =&gt; "/tmp/db.groonga")</pre>
    
  </div>

  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class="type">(<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class="name">option</span>
      
      
        <span class="type">(<tt>::Hash</tt>)</span>
      
      
      
        &mdash;
        <div class="inline"><p>options The name and value
pairs. Omitted names are initialized as the default value.</p></div>
      
    </li>
  
</ul>

  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 192</span>

static VALUE
rb_grn_database_s_create (int argc, VALUE *argv, VALUE klass)
{
    grn_ctx *context;
    grn_obj *old_database, *database;
    grn_db_create_optarg create_args;
    const char *path = NULL;
    VALUE rb_database;
    VALUE rb_path, options, rb_context, builtin_type_names;
    grn_bool owner;

    rb_scan_args(argc, argv, "01", &amp;options);

    rb_grn_scan_options(options,
                        "path", &amp;rb_path,
			"context", &amp;rb_context,
                        "builtin_type_names", &amp;builtin_type_names,
			NULL);

    if (!NIL_P(rb_path))
        path = StringValuePtr(rb_path);
    context = rb_grn_context_ensure(&amp;rb_context);

    create_args.builtin_type_names = NULL;
    create_args.n_builtin_type_names = 0;

    old_database = grn_ctx_db(context);
    if (old_database)
	grn_obj_unlink(context, old_database);
    reset_floating_objects(rb_context);
    database = grn_db_create(context, path, &amp;create_args);
    rb_grn_context_check(context, rb_ary_new4(argc, argv));
    owner = (context-&gt;flags &amp; GRN_CTX_PER_DB) ? GRN_FALSE : GRN_TRUE;
    rb_database = GRNOBJECT2RVAL(klass, context, database, owner);
    rb_iv_set(rb_database, "@context", rb_context);
    if (!NIL_P(rb_context))
	rb_iv_set(rb_context, "database", rb_database);
    rb_grn_context_check(context, rb_ary_new4(argc, argv));

    if (rb_block_given_p())
        return rb_ensure(rb_yield, rb_database,
			 rb_grn_database_close, rb_database);
    else
        return rb_database;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open-class_method">
  
    
      <span class="overload">+ (<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>) <strong>Groonga::Database.open</strong>(path, options = nil) </span>
    
      <span class="overload">+ (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>Groonga::Database.open</strong>(path, options = nil) {|database| ... }</span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>既存のデータベースを開く。ブロックを指定した場合はブロッ
クに開いたデータベースを渡し、ブロックを抜けるときに閉じ
る。</p>
<p><em>options</em> にはハッシュでオプションを指定する。指定できるオ
プションは以下の通り。</p>

  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>) <strong>Groonga::Database.open</strong>(path, options = nil) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class="type">(<tt><span class="object_link"><a href="" title="Groonga::Database (class)">Groonga::Database</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>Groonga::Database.open</strong>(path, options = nil) {|database| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class="type">(<tt>database</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class="name">options</span>
      
      
        <span class="type">(<tt>::Hash</tt>)</span>
      
      
      
        &mdash;
        <div class="inline"><p>The name and value
pairs. Omitted names are initialized as the default value.</p></div>
      
    </li>
  
</ul>

  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


305
306
307
308
309
310
311
312
313
314
315
316</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 305</span>

static VALUE
rb_grn_database_s_open (int argc, VALUE *argv, VALUE klass)
{
    VALUE database;

    database = rb_obj_alloc(klass);
    rb_grn_database_initialize(argc, argv, database);
    if (rb_block_given_p())
        return rb_ensure(rb_yield, database, rb_grn_database_close, database);
    else
        return database;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clear_lock-instance_method">
  
    - (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>clear_lock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>call-seq:
  database.clear_lock</p>
<p><em>database</em> のロックを強制的に解除する。</p>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


494
495
496
497
498
499
500
501
502
503
504
505
506</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 494</span>

static VALUE
rb_grn_database_clear_lock (VALUE self)
{
    grn_ctx *context;
    grn_obj *database;

    rb_grn_database_deconstruct(SELF(self), &amp;database, &amp;context,
				NULL, NULL, NULL, NULL);

    grn_obj_clear_lock(context, database);

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close-instance_method">
  
    - (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>close</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>call-seq:
  database.close</p>
<p><em>database</em> が使用しているリソースを開放する。これ以降 <em>database</em> を
使うことはできない。</p>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


146
147
148
149
150
151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 146</span>

static VALUE
rb_grn_database_close (VALUE self)
{
    VALUE rb_context;

    rb_context = rb_iv_get(self, "@context");
    if (!NIL_P(rb_context))
	rb_iv_set(rb_context, "database", Qnil);

    return rb_grn_object_close(self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="defrag-instance_method">
  
    - (<tt>Integer</tt>) <strong>defrag</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>call-seq:
  database.defrag(options={}) → n_segments</p>
<p>Defrags all variable size columns in the database.</p>

  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class="type">(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class="inline"><p>the number of defraged segments</p></div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class="inline"><p>1.2.6</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 564</span>

static VALUE
rb_grn_database_defrag (int argc, VALUE *argv, VALUE self)
{
    grn_ctx *context;
    grn_obj *database;
    int n_segments;
    VALUE options, rb_threshold;
    int threshold = 0;

    rb_scan_args(argc, argv, "01", &amp;options);
    rb_grn_scan_options(options,
			"threshold", &amp;rb_threshold,
			NULL);
    if (!NIL_P(rb_threshold)) {
	threshold = NUM2INT(rb_threshold);
    }

    rb_grn_database_deconstruct(SELF(self), &amp;database, &amp;context,
				NULL, NULL, NULL, NULL);
    n_segments = grn_obj_defrag(context, database, threshold);
    rb_grn_context_check(context, self);

    return INT2NUM(n_segments);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each-instance_method">
  
    
      <span class="overload">- (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>each</strong> {|object| ... }</span>
    
      <span class="overload">- (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>each</strong>(options = nil) {|object| ... }</span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>データベース内のオブジェクトを順番にブロックに渡す。</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class="inline"><p>すべてのオブジェクトの名前を表示する:</p></div></p>
      
      <pre class="example code"><span class="id identifier rubyid_database">database</span><span class="period">.</span><span class="id identifier rubyid_each">each</span> <span class="kw">do</span> <span class="op">|</span><span class="id identifier rubyid_object">object</span><span class="op">|</span>
  <span class="id identifier rubyid_p">p</span> <span class="id identifier rubyid_object">object</span><span class="period">.</span><span class="id identifier rubyid_name">name</span>
<span class="kw">end</span></pre>
    
      
        <p class="example_title"><div class="inline"><p>すべてのオブジェクトの名前をID順で表示する:</p></div></p>
      
      <pre class="example code"><span class="id identifier rubyid_database">database</span><span class="period">.</span><span class="id identifier rubyid_each">each</span><span class="lparen">(</span><span class="symbol">:order_by</span> <span class="op">=&gt;</span> <span class="symbol">:id</span><span class="rparen">)</span> <span class="kw">do</span> <span class="op">|</span><span class="id identifier rubyid_object">object</span><span class="op">|</span>
  <span class="id identifier rubyid_p">p</span> <span class="id identifier rubyid_object">object</span><span class="period">.</span><span class="id identifier rubyid_name">name</span>
<span class="kw">end</span></pre>
    
      
        <p class="example_title"><div class="inline"><p>すべてのオブジェクトの名前をキー名の降順で表示する:</p></div></p>
      
      <pre class="example code"><span class="id identifier rubyid_database">database</span><span class="period">.</span><span class="id identifier rubyid_each">each</span><span class="lparen">(</span><span class="symbol">:order_by</span> <span class="op">=&gt;</span> <span class="symbol">:key</span><span class="comma">,</span> <span class="symbol">:order</span> <span class="op">=&gt;</span> <span class="symbol">:desc</span><span class="rparen">)</span> <span class="kw">do</span> <span class="op">|</span><span class="id identifier rubyid_object">object</span><span class="op">|</span>
  <span class="id identifier rubyid_p">p</span> <span class="id identifier rubyid_object">object</span><span class="period">.</span><span class="id identifier rubyid_name">name</span>
<span class="kw">end</span></pre>
    
  </div>

  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>each</strong> {|object| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class="type">(<tt>object</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>each</strong>(options = nil) {|object| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class="type">(<tt>object</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class="name">options</span>
      
      
        <span class="type">(<tt>::Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 355</span>

static VALUE
rb_grn_database_each (int argc, VALUE *argv, VALUE self)
{
    grn_ctx *context = NULL;
    grn_obj *database;
    grn_table_cursor *cursor;
    VALUE rb_cursor, rb_options, rb_order, rb_order_by;
    int flags = 0;
    grn_id id;
    VALUE exception;

    RETURN_ENUMERATOR(self, argc, argv);

    rb_grn_database_deconstruct(SELF(self), &amp;database, &amp;context,
				NULL, NULL, NULL, NULL);

    rb_scan_args(argc, argv, "01", &amp;rb_options);

    rb_grn_scan_options(rb_options,
			"order", &amp;rb_order,
			"order_by", &amp;rb_order_by,
			NULL);

    flags |= rb_grn_table_cursor_order_to_flag(rb_order);
    flags |= rb_grn_table_cursor_order_by_to_flag(GRN_TABLE_PAT_KEY,
						  self,
						  rb_order_by);

    cursor = grn_table_cursor_open(context, database, NULL, 0, NULL, 0,
				   0, -1,
				   flags);
    rb_cursor = GRNTABLECURSOR2RVAL(Qnil, context, cursor);
    rb_iv_set(self, "cursor", rb_cursor);
    while ((id = grn_table_cursor_next(context, cursor)) != GRN_ID_NIL) {
	grn_obj *object;

	object = grn_ctx_at(context, id);
	exception = rb_grn_context_to_exception(context, self);
	if (!NIL_P(exception)) {
	    rb_grn_object_close(rb_cursor);
	    rb_iv_set(self, "cursor", Qnil);
	    rb_exc_raise(exception);
	}

	if (object)
	    rb_yield(GRNOBJECT2RVAL(Qnil, context, object, GRN_FALSE));
    }
    rb_grn_object_close(rb_cursor);
    rb_iv_set(self, "cursor", Qnil);

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="lock-instance_method">
  
    - (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>lock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>call-seq:
  database.lock(options={})
  database.lock(options={}) { … }</p>
<p><em>database</em> をロックする。ロックに失敗した場合は
Groonga::ResourceDeadlockAvoided例外が発生する。</p>
<p>ブロックを指定した場合はブロックを抜けたときにunlockする。</p>
<p>利用可能なオプションは以下の通り。</p>

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class="name">options</span>
      
      
        <span class="type">(<tt>::Hash</tt>)</span>
      
      
      
        &mdash;
        <div class="inline"><p>The name and value
pairs. Omitted names are initialized as the default value</p></div>
      
    </li>
  
</ul>

  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 454</span>

static VALUE
rb_grn_database_lock (int argc, VALUE *argv, VALUE self)
{
    grn_ctx *context;
    grn_obj *database;
    int timeout = 0;
    grn_rc rc;
    VALUE options, rb_timeout;

    rb_scan_args(argc, argv, "01",  &amp;options);

    rb_grn_database_deconstruct(SELF(self), &amp;database, &amp;context,
				NULL, NULL, NULL, NULL);

    rb_grn_scan_options(options,
			"timeout", &amp;rb_timeout,
			NULL);

    if (!NIL_P(rb_timeout))
	timeout = NUM2UINT(rb_timeout);

    rc = grn_obj_lock(context, database, GRN_ID_NIL, timeout);
    rb_grn_context_check(context, self);
    rb_grn_rc_check(rc, self);

    if (rb_block_given_p()) {
	return rb_ensure(rb_yield, Qnil, rb_grn_database_unlock, self);
    } else {
	return Qnil;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="locked?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>locked?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>call-seq:
  database.locked?</p>
<p><em>database</em> がロックされていれば <ins>true</ins> を返す。</p>

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class="type">(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


516
517
518
519
520
521
522
523
524
525
526</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 516</span>

static VALUE
rb_grn_database_is_locked (VALUE self)
{
    grn_ctx *context;
    grn_obj *database;

    rb_grn_database_deconstruct(SELF(self), &amp;database, &amp;context,
				NULL, NULL, NULL, NULL);

    return CBOOL2RVAL(grn_obj_is_locked(context, database));
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tables-instance_method">
  
    - (<tt><span class="object_link"><a href="Array.html" title="Groonga::Array (class)">Array</a></span>&lt;<span class="object_link"><a href="Table.html" title="Groonga::Table (class)">Groonga::Table</a></span>] tables defined in the database</tt>) <strong>tables</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Array&lt;Groonga::Table] tables defined in the database</p>

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class="type">(<tt><span class="object_link"><a href="Array.html" title="Groonga::Array (class)">Array</a></span>&lt;<span class="object_link"><a href="Table.html" title="Groonga::Table (class)">Groonga::Table</a></span>] tables defined in the database</tt>)</span>
      
      
      
        &mdash;
        <div class="inline"><p>Array&lt;Groonga::Table] tables defined in the database</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/groonga/database.rb', line 21</span>

<span class="kw">def</span> <span class="id identifier rubyid_tables">tables</span>
  <span class="id identifier rubyid_find_all">find_all</span> <span class="kw">do</span> <span class="op">|</span><span class="id identifier rubyid_object">object</span><span class="op">|</span>
    <span class="id identifier rubyid_object">object</span><span class="period">.</span><span class="id identifier rubyid_is_a?">is_a?</span><span class="lparen">(</span><span class="const">Groonga</span><span class="op">::</span><span class="const">Table</span><span class="rparen">)</span>
  <span class="kw">end</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="touch-instance_method">
  
    - (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>touch</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>call-seq:
  database.touch</p>
<p><em>database</em> の最終更新時刻を現在時刻にする。</p>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


536
537
538
539
540
541
542
543
544
545
546
547</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 536</span>

static VALUE
rb_grn_database_touch (VALUE self)
{
    grn_ctx *context;
    grn_obj *database;

    rb_grn_database_deconstruct(SELF(self), &amp;database, &amp;context,
				NULL, NULL, NULL, NULL);

    grn_db_touch(context, database);
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unlock-instance_method">
  
    - (<tt><span class="object_link"><a href="Object.html" title="Groonga::Object (class)">Object</a></span></tt>) <strong>unlock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>call-seq:
  database.unlock</p>
<p><em>database</em> のロックを解除する。</p>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/groonga/rb-grn-database.c', line 416</span>

static VALUE
rb_grn_database_unlock (VALUE self)
{
    grn_ctx *context;
    grn_obj *database;
    grn_rc rc;

    rb_grn_database_deconstruct(SELF(self), &amp;database, &amp;context,
				NULL, NULL, NULL, NULL);

    rc = grn_obj_unlock(context, database, GRN_ID_NIL);
    rb_grn_context_check(context, self);
    rb_grn_rc_check(rc, self);

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer"></div>

  
    </div>

    <div class="sponsors">
      <p id="sponsor-rubyforge">
        <a href="http://rubyforge.org/projects/groonga/">
          <img src="../../../rubyforge.png" width="120" height="24" border="0" alt="ラングバプロジェクトはRubyForge.orgにホスティングしてもらっています。" />
        </a>
      </p>
      <p id="sponsor-github">
        <a href="http://github.com/ranguba/">
          <img src="../../../github-logo.png" width="100" height="45" border="0" alt="ラングバプロジェクトはGitHubにホスティングしてもらっています。" />
        </a>
      </p>
      <p id="sponsor-tango">
	<a href="http://tango.freedesktop.org/">
          <img width="120" height="53" border="0" alt="Tango Desktop Projectのアイコンを利用しています。" src="../../../tango-logo.png" />
        </a>
      </p>

<!-- Piwik -->
<a href="http://piwik.org" title="Web analytics" onclick="window.open(this.href);return(false);">
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://www.clear-code.com/piwik/" : "http://www.clear-code.com/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 2;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p>Web analytics <img src="http://www.clear-code.com/piwik/piwik.php?idsite=2" style="border:0" alt=""/></p></noscript></object></a>
<!-- End Piwik Tag -->
    </div>

</body>
</html>
