<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../ranguba.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../favicon.ico" />
    <link rel="icon" href="../../../../favicon.png" />
    <title>
  Class: Racknga::Middleware::Deflater
  
    &mdash; racknga
  
 - ラングバ</title>


  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
<div class="header">
  <div class="title">
    <a href="../../../../index.html.ja">
      <span class="title">
  Class: Racknga::Middleware::Deflater
  
    &mdash; racknga
  
</span>
      <span class="title-separator">-</span>
      <span class="title-project">ラングバ</span>
    </a>
  </div>
  <ul class="other-languages">
    <li id="other-language-english" lang="en" xml:lang="en"><a href="../../../../racknga/en/Racknga/Middleware/Deflater.html">English</a></li>
  </ul>
  <ul class="menu">
    <li id="menu-reference"><a href="../../../../rroonga/ja/">リファレンスマニュアル</a></li>
    <li id="menu-tutorial"><a href="../../../../rroonga/ja/file.tutorial.html">チュートリアル</a></li>
    <li id="menu-install"><a href="../../../../index.html.ja#install-rroonga">インストール</a></li>
    <li id="menu-developer"><a href="../../../../developer.html.ja">開発者向け情報</a></li>
  </ul>
</div>

<div class="content">


    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (D)</a> &raquo;
    <span class="title"><span class="object_link"><a href="../../Racknga.html" title="Racknga (module)">Racknga</a></span></span> &raquo; <span class="title"><span class="object_link"><a href="../Middleware.html" title="Racknga::Middleware (module)">Middleware</a></span></span>
     &raquo; 
    <span class="title">Deflater</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link" href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link" href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link" href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Racknga::Middleware::Deflater
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Racknga::Middleware::Deflater</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/racknga/middleware/deflater.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is a middleware that deflates response except for IE6. If your Rack
application need support IE6, use this middleware instead of
Rack::Deflater.</p>

<p>Usage:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">"racknga"</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Racknga</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleware</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflater</span>
<span class="ruby-identifier">run</span> <span class="ruby-constant">YourApplication</span>
</pre>

<p>You can use this middleware with Racknga::Middleware::Cache. You
<strong>should</strong> use this middleware before the cache middleware:</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Racknga</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleawre</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflater</span>
<span class="ruby-identifier">use</span> <span class="ruby-constant">Racknga</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleawre</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span>, :<span class="ruby-identifier">database_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">"var/cache/db"</span>
<span class="ruby-identifier">run</span> <span class="ruby-constant">YourApplication</span>
</pre>

<p>If you use this middleware after the cache middleware, you get two
problems. It's the first problem pattern that the cache middleware may
return deflated response to IE6. It's the second problem pattern that the
cache middleware may return not deflated response to no IE6 user agent.
Here are examples:</p>

<p>Problem case:</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Racknga</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleawre</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span>, :<span class="ruby-identifier">database_path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">"var/cache/db"</span>
<span class="ruby-identifier">use</span> <span class="ruby-constant">Racknga</span><span class="ruby-operator">::</span><span class="ruby-constant">Middleawre</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflater</span>
<span class="ruby-identifier">run</span> <span class="ruby-constant">YourApplication</span>
</pre>

<p>Problem pattern1:</p>

<pre class="code ruby"><code>http://localhost:9292/ by Firefox -&gt; no cache. cache deflated response.
http://localhost:9292/ by IE6     -&gt; use deflated response cache.</code></pre>

<p>Problem pattern2:</p>

<pre class="code ruby"><code>http://localhost:9292/ by IE6     -&gt; no cache. cache not deflated response.
http://localhost:9292/ by Firefox -&gt; use not deflated response cache.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#call-instance_method" title="#call (instance method)">- (Object) <strong>call</strong>(environment) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>For Rack.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Deflater) <strong>initialize</strong>(application, options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>A new instance of Deflater.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class="object_link"><a href="" title="Racknga::Middleware::Deflater (class)">Deflater</a></span></tt>) <strong>initialize</strong>(application, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A new instance of Deflater</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/racknga/middleware/deflater.rb', line 58</span>

<span class="kw">def</span> <span class="id identifier rubyid_initialize">initialize</span><span class="lparen">(</span><span class="id identifier rubyid_application">application</span><span class="comma">,</span> <span class="id identifier rubyid_options">options</span><span class="op">=</span><span class="lbrace">{</span><span class="rbrace">}</span><span class="rparen">)</span>
  <span class="ivar">@application</span> <span class="op">=</span> <span class="id identifier rubyid_application">application</span>
  <span class="ivar">@deflater</span> <span class="op">=</span> <span class="const">Rack</span><span class="op">::</span><span class="const">Deflater</span><span class="period">.</span><span class="id identifier rubyid_new">new</span><span class="lparen">(</span><span class="ivar">@application</span><span class="rparen">)</span>
  <span class="ivar">@options</span> <span class="op">=</span> <span class="const">Utils</span><span class="period">.</span><span class="id identifier rubyid_normalize_options">normalize_options</span><span class="lparen">(</span><span class="id identifier rubyid_options">options</span> <span class="op">||</span> <span class="lbrace">{</span><span class="rbrace">}</span><span class="rparen">)</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="call-instance_method">
  
    - (<tt>Object</tt>) <strong>call</strong>(environment) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>For Rack.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/racknga/middleware/deflater.rb', line 65</span>

<span class="kw">def</span> <span class="id identifier rubyid_call">call</span><span class="lparen">(</span><span class="id identifier rubyid_environment">environment</span><span class="rparen">)</span>
  <span class="kw">if</span> <span class="id identifier rubyid_ie6?">ie6?</span><span class="lparen">(</span><span class="id identifier rubyid_environment">environment</span><span class="rparen">)</span> <span class="kw">or</span> <span class="kw">not</span> <span class="id identifier rubyid_valid_accept_encoding?">valid_accept_encoding?</span><span class="lparen">(</span><span class="id identifier rubyid_environment">environment</span><span class="rparen">)</span>
    <span class="ivar">@application</span><span class="period">.</span><span class="id identifier rubyid_call">call</span><span class="lparen">(</span><span class="id identifier rubyid_environment">environment</span><span class="rparen">)</span>
  <span class="kw">else</span>
    <span class="ivar">@deflater</span><span class="period">.</span><span class="id identifier rubyid_call">call</span><span class="lparen">(</span><span class="id identifier rubyid_environment">environment</span><span class="rparen">)</span>
  <span class="kw">end</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer"></div>

  
    </div>

    <div class="sponsors">
      <p id="sponsor-rubyforge">
        <a href="http://rubyforge.org/projects/groonga/">
          <img src="../../../../rubyforge.png" width="120" height="24" border="0" alt="ラングバプロジェクトはRubyForge.orgにホスティングしてもらっています。" />
        </a>
      </p>
      <p id="sponsor-github">
        <a href="http://github.com/ranguba/">
          <img src="../../../../github-logo.png" width="100" height="45" border="0" alt="ラングバプロジェクトはGitHubにホスティングしてもらっています。" />
        </a>
      </p>
      <p id="sponsor-tango">
	<a href="http://tango.freedesktop.org/">
          <img width="120" height="53" border="0" alt="Tango Desktop Projectのアイコンを利用しています。" src="../../../../tango-logo.png" />
        </a>
      </p>

<!-- Piwik -->
<a href="http://piwik.org" title="Web analytics" onclick="window.open(this.href);return(false);">
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://www.clear-code.com/piwik/" : "http://www.clear-code.com/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 2;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p>Web analytics <img src="http://www.clear-code.com/piwik/piwik.php?idsite=2" style="border:0" alt=""/></p></noscript></object></a>
<!-- End Piwik Tag -->
    </div>

</body>
</html>
