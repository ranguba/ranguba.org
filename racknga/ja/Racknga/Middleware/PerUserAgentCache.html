<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../ranguba.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../favicon.ico" />
    <link rel="icon" href="../../../../favicon.png" />
    <title>
  Class: Racknga::Middleware::PerUserAgentCache
  
    &mdash; racknga
  
 - ラングバ</title>


  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
<div class="header">
  <div class="title">
    <a href="../../../../ja/">
      <span class="title">
  Class: Racknga::Middleware::PerUserAgentCache
  
    &mdash; racknga
  
</span>
      <span class="title-separator">-</span>
      <span class="title-project">ラングバ</span>
    </a>
  </div>
  <ul class="other-languages">
    <li id="other-language-english" lang="en" xml:lang="en"><a href="../../../../racknga/en/Racknga/Middleware/PerUserAgentCache.html">English</a></li>
  </ul>
  <ul class="menu">
    <li id="menu-reference"><a href="../../../../rroonga/ja/">リファレンスマニュアル</a></li>
    <li id="menu-tutorial"><a href="../../../../rroonga/ja/file.tutorial.html">チュートリアル</a></li>
    <li id="menu-install"><a href="../../../../ja/#install-rroonga">インストール</a></li>
    <li id="menu-developer"><a href="../../../../developer.html.ja">開発者向け情報</a></li>
  </ul>
</div>

<div class="content">


    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (P)</a> &raquo; 
    <span class="title"><span class="object_link"><a href="../../Racknga.html" title="Racknga (module)">Racknga</a></span></span> &raquo; <span class="title"><span class="object_link"><a href="../Middleware.html" title="Racknga::Middleware (module)">Middleware</a></span></span>
     &raquo; 
    <span class="title">PerUserAgentCache</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Racknga::Middleware::PerUserAgentCache
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Racknga::Middleware::PerUserAgentCache</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/racknga/middleware/cache.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is a helper middleware for Racknga::Middleware::Cache.</p>

<p>If your Rack application provides different views to mobile user agent and
PC user agent in the same URL, this middleware is useful. Your Rack
application can has different caches for mobile user agent and PC user
agent.</p>

<p>This middleware requires jpmobile.</p>

<p>Usage:</p>

<pre class="code"><span class="use identifier id">use</span> <span class="Racnkga constant id">Racnkga</span><span class="colon2 op">::</span><span class="Middleware constant id">Middleware</span><span class="colon2 op">::</span><span class="PerUserAgentCache constant id">PerUserAgentCache</span>
<span class="use identifier id">use</span> <span class="Racnkga constant id">Racnkga</span><span class="colon2 op">::</span><span class="Middleware constant id">Middleware</span><span class="colon2 op">::</span><span class="Cache constant id">Cache</span><span class="comma token">,</span> <span class="symbol val">:database_path</span> <span class="assign token">=</span><span class="gt op">&gt;</span> <span class="string val">"var/cache/db"</span>
<span class="run identifier id">run</span> <span class="YourApplication constant id">YourApplication</span>
</pre>


  </div>
</div>
<div class="tags">
  

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://jpmobile-rails.org/" target="_parent" title="jpmobile">jpmobile</a></li>
    
      <li><span class="object_link"><a href="Cache.html" title="Racknga::Middleware::Cache (class)">Cache</a></span></li>
    
  </ul>

</div>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#call-instance_method" title="#call (instance method)">- (Object) <strong>call</strong>(environment) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>For Rack.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (PerUserAgentCache) <strong>initialize</strong>(application) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>A new instance of PerUserAgentCache.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class="object_link"><a href="" title="Racknga::Middleware::PerUserAgentCache (class)">PerUserAgentCache</a></span></tt>) <strong>initialize</strong>(application) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>A new instance of PerUserAgentCache</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/racknga/middleware/cache.rb', line 44</span>

<span class="def def kw">def</span> <span class="initialize identifier id">initialize</span><span class="lparen token">(</span><span class="application identifier id">application</span><span class="rparen token">)</span>
  <span class="@application ivar id">@application</span> <span class="assign token">=</span> <span class="application identifier id">application</span>
<span class="end end kw">end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="call-instance_method">
  
    - (<tt>Object</tt>) <strong>call</strong>(environment) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>For Rack.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/racknga/middleware/cache.rb', line 49</span>

<span class="def def kw">def</span> <span class="call identifier id">call</span><span class="lparen token">(</span><span class="environment identifier id">environment</span><span class="rparen token">)</span>
  <span class="mobile identifier id">mobile</span> <span class="assign token">=</span> <span class="environment identifier id">environment</span><span class="lbrack token">[</span><span class="string val">"rack.jpmobile"</span><span class="rbrack token">]</span>
  <span class="if if kw">if</span> <span class="mobile identifier id">mobile</span>
    <span class="last_component identifier id">last_component</span> <span class="assign token">=</span> <span class="mobile identifier id">mobile</span><span class="dot token">.</span><span class="class identifier id">class</span><span class="dot token">.</span><span class="name identifier id">name</span><span class="dot token">.</span><span class="split identifier id">split</span><span class="lparen token">(</span><span class="regexp val">/::/</span><span class="rparen token">)</span><span class="dot token">.</span><span class="last identifier id">last</span>
    <span class="user_agent_key identifier id">user_agent_key</span> <span class="assign token">=</span> <span class="dstring node">"mobile:#{last_component.downcase}"</span>
  <span class="else else kw">else</span>
    <span class="user_agent_key identifier id">user_agent_key</span> <span class="assign token">=</span> <span class="string val">"pc"</span>
  <span class="end end kw">end</span>
  <span class="key identifier id">key</span> <span class="assign token">=</span> <span class="environment identifier id">environment</span><span class="lbrack token">[</span><span class="Cache constant id">Cache</span><span class="colon2 op">::</span><span class="KEY constant id">KEY</span><span class="rbrack token">]</span>
  <span class="environment identifier id">environment</span><span class="lbrack token">[</span><span class="Cache constant id">Cache</span><span class="colon2 op">::</span><span class="KEY constant id">KEY</span><span class="rbrack token">]</span> <span class="assign token">=</span> <span class="lbrack token">[</span><span class="key identifier id">key</span><span class="comma token">,</span> <span class="user_agent_key identifier id">user_agent_key</span><span class="rbrack token">]</span><span class="dot token">.</span><span class="join identifier id">join</span><span class="lparen token">(</span><span class="string val">":"</span><span class="rparen token">)</span>
  <span class="@application ivar id">@application</span><span class="dot token">.</span><span class="call identifier id">call</span><span class="lparen token">(</span><span class="environment identifier id">environment</span><span class="rparen token">)</span>
<span class="end end kw">end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer"></div>

  
    </div>

    <div class="sponsors">
      <p id="sponsor-rubyforge">
        <a href="http://rubyforge.org/projects/groonga/">
          <img src="../../../../rubyforge.png" width="120" height="24" border="0" alt="ラングバプロジェクトはRubyForge.orgにホスティングしてもらっています。" />
        </a>
      </p>
      <p id="sponsor-github">
        <a href="http://github.com/ranguba/">
          <img src="../../../../github-logo.png" width="100" height="45" border="0" alt="ラングバプロジェクトはGitHubにホスティングしてもらっています。" />
        </a>
      </p>
      <p id="sponsor-tango">
	<a href="http://tango.freedesktop.org/">
          <img width="120" height="53" border="0" alt="Tango Desktop Projectのアイコンを利用しています。" src="../../../../tango-logo.png" />
        </a>
      </p>

<!-- Piwik -->
<a href="http://piwik.org" title="Web analytics" onclick="window.open(this.href);return(false);">
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://www.clear-code.com/piwik/" : "http://www.clear-code.com/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
piwik_action_name = '';
piwik_idsite = 2;
piwik_url = pkBaseURL + "piwik.php";
piwik_log(piwik_action_name, piwik_idsite, piwik_url);
</script>
<object><noscript><p>Web analytics <img src="http://www.clear-code.com/piwik/piwik.php?idsite=2" style="border:0" alt=""/></p></noscript></object></a>
<!-- End Piwik Tag -->
    </div>

</body>
</html>
